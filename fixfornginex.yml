---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# FixForNginex
# https://cloud.redhat.com/insights/remediations/579eda98-b074-499e-b674-779bee9b5a6f
# Generated by Red Hat Insights on Mon, 16 Nov 2020 12:42:50 GMT
# Created by gregory.zuckerman

# Nginx service will fail to start during system boot when listening on a specific IP address or configured with load balancing on RHEL8
# Identifier: (advisor:nginx_fail_to_start_during_boot|NGINX_FAIL_TO_START_INFO,fix)
# Version: 5f7679cc1dd2d29dab6ef4bf4b980aadf4f86ebb
- name: create systemd config file
  hosts: "127.0.0.1"
  become: true

  tasks:
    - name: create systemd config file
      blockinfile:
        path: /etc/systemd/system/nginx.service.d/dependency.conf
        create: yes
        block: |
          [Unit]
              After=network-online.target
              Requires=network-online.target
      notify: reload systemd

  handlers:
    - name: reload systemd
      systemd: daemon_reload=yes


- name: run insights
  hosts: "127.0.0.1"
  become: True
  gather_facts: False
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false